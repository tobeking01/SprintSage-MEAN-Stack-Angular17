<!-- Main container -->
<div class="main-container">
  <!-- Header -->
  <mat-toolbar class="project-header">
    <mat-list>
      <mat-list-item>
        <span matListItemTitle>Manage Projects</span>
        <span matListItemLine>List of all created and joined projects</span>
      </mat-list-item>
    </mat-list>
  </mat-toolbar>

  <!-- Body -->
  <div class="main-body">
    <!-- Filter Section -->
    <div fxLayout="row" fxLayoutAlign="start center" class="filter-section">
      <mat-form-field fxFlex="60">
        <mat-icon matPrefix>search</mat-icon>
        <mat-label>Search Projects</mat-label>
        <input
          matInput
          (keyup)="applyFilter($event)"
          placeholder="Search"
          #input
        />
      </mat-form-field>
    </div>

    <button
      mat-raised-button
      color="accent"
      (click)="openAddEditProjectDialog()"
    >
      ADD PROJECT
    </button>
    <button
      mat-raised-button
      color="primary"
      (click)="openTeamDialog()"
      style="margin-left: 30px"
    >
      MANAGE TEAM
    </button>

    <br />
    <!-- Loading Spinner -->
    <mat-spinner *ngIf="isLoading"></mat-spinner>

    <!-- Error Message -->
    <div *ngIf="error" class="error-message">
      {{ error }}
    </div>

    <!-- Newly Added Projects Section -->
    <div class="projects-section">
      <ng-container *ngIf="MyDataSource.data.length; else noProjectTemplate">
        <div *ngFor="let project of MyDataSource.data" class="project-item">
          <h3>{{ project.projectName }}</h3>
          <p>{{ project.description }}</p>

          <!-- Teams Section -->
          <ng-container
            *ngIf="project.teams && project.teams.length; else noTeamsTemplate"
          >
            <div *ngFor="let team of project.teams">
              <h4>{{ team.teamName }}</h4>

              <!-- Members Section -->
              <ng-container
                *ngIf="
                  team.teamMembers && team.teamMembers.length;
                  else noMembersTemplate
                "
              >
                <ul>
                  <li *ngFor="let memberId of team.teamMembers">
                    {{ teamMembersDetails[memberId]?.name || "Loading..." }}
                  </li>
                </ul>
              </ng-container>

              <ng-template #noMembersTemplate>
                <p>No Members in this Team</p>
              </ng-template>
            </div>
          </ng-container>

          <ng-template #noTeamsTemplate>
            <p>No Teams Available</p>
          </ng-template>

          <p>Number of Tickets: {{ project.tickets?.length || 0 }}</p>
          <p>Start Date: {{ project.startDate }}</p>
          <p>End Date: {{ project.endDate }}</p>
        </div>
      </ng-container>

      <ng-template #noProjectTemplate>
        <div class="no-projects">No Projects Available!</div>
      </ng-template>
    </div>
  </div>
</div>

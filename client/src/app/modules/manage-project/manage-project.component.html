<!-- Main container -->
<div class="main-container">
  <!-- Header -->
  <mat-toolbar class="project-header">
    <mat-list>
      <mat-list-item>
        <h3>Manage Projects</h3>
        <p>List of all your created and added to projects</p>
      </mat-list-item>
    </mat-list>
  </mat-toolbar>

  <!-- Body -->
  <div class="main-body">
    <div class="filter">
      <!-- Filter Container -->
      <div class="filter-container">
        <!-- Main Search Bar -->
        <mat-form-field class="filter-item">
          <mat-icon matPrefix>search</mat-icon>
          <mat-label>Search Projects</mat-label>
          <input
            matInput
            (keyup)="applyFilter($event)"
            placeholder="Search by name"
            #inputName
          />
        </mat-form-field>

        <!-- Team Filter -->
        <mat-form-field class="filter-item">
          <mat-select
            placeholder="Team"
            (selectionChange)="applyTeamFilter($event)"
          >
            <mat-option *ngFor="let team of teamInfo" [value]="team._id">{{
              team.teamName
            }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="button-container">
        <button
          class="action-button"
          mat-raised-button
          color="accent"
          (click)="openTeamDialog()"
        >
          CREATE TEAM
        </button>
        <button
          class="action-button"
          mat-raised-button
          color="accent"
          (click)="openAddEditProjectDialog()"
        >
          CREATE PROJECT
        </button>
      </div>
      <br />
      <!-- Projects display -->
      <div class="projects-display">
        <!-- Loading Spinner -->
        <mat-spinner *ngIf="isLoading"></mat-spinner>

        <!-- Teams and their associated projects -->
        <ng-container
          *ngIf="teamInfo && teamInfo.length; else noProjectTemplate"
        >
          <div *ngFor="let team of teamInfo" class="team-item">
            <h3>{{ team.teamName }}</h3>

            <!-- Projects associated with the current team -->
            <ng-container
              *ngIf="
                team.projects && team.projects.length;
                else noProjectForTeamTemplate
              "
            >
              <div
                *ngFor="let project of team.projects"
                class="individual-project"
                (click)="openProjectDetails(project.project)"
              >
                <h4>{{ project.project.projectName }}</h4>
                <p>
                  Number of Tickets: {{ project.project.tickets?.length || 0 }}
                </p>
                <p>
                  Start Date:
                  {{ project.project.startDate | date : "MMM d, y" }}
                </p>
                <p>
                  End Date:
                  {{ project.project.endDate | date : "MMM d, y" }}
                </p>
              </div>
            </ng-container>

            <!-- Members of the current team -->
            <ul>
              <ng-container *ngFor="let member of team.teamMembers">
                <li>
                  <span [matTooltip]="getMemberTooltip(member.user)">
                    {{ member.user.firstName }} {{ member.user.lastName }}
                  </span>
                </li>
              </ng-container>
            </ul>
          </div>
        </ng-container>

        <!-- Template to show when no projects are available for the whole system -->
        <ng-template #noProjectTemplate>
          <div class="no-projects">No Projects Available!</div>
        </ng-template>

        <!-- Template to show when no projects are available for a specific team -->
        <ng-template #noProjectForTeamTemplate>
          <div class="no-projects">No Projects Available for this Team!</div>
        </ng-template>
      </div>
    </div>
  </div>
</div>
